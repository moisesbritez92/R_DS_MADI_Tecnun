---
title: ""
output: 
  pdf_document:
    includes:
      in_header: header.tex
    keep_tex: true
geometry: margin=1in
---

\thispagestyle{firstpage}

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Asignatura: Data Science.\
Fecha: 15/9/25

Nombre: Gorka\
\
Apellido: Dabó\

\hrule

# contexto

Los datos del examen se encuentran en `/data/smmh.csv`. Estos datos contiene información sobre 481 encuestas sobre el uso de las redes sociales y su impacto en aspectos psicológicos y conductuales.\
Al cargar los datos, se debe obtener un data.frame con 481 filas y 21 columnas.\

# Librerias necesarias

```{r,warning=FALSE,message=FALSE}
library(viridis)
library(ggplot2)
library(tidyverse)
library(dplyr)
library(pwr)
library(corrplot)

```

# Problema 1 (1 punto)

**Cargarlos los datos `smmh.csv`.**

```{r,warning=FALSE,message=FALSE}
data <- read.csv('./data/smmh.csv', header = T, sep = ',', stringsAsFactors = F)

```

**Se pide eliminar las columnas que no aportan información y filtrar los "missing values". Para esto, tenga en cuenta que los "missing values" no aparecen como un `NA` sino como una variable "character" que vale "N/A". En concreto, elimine la primera y la sexta columna. Una vez eliminadas estas 2 columnas, elimine todas las filas en las que hay "missing values".**

```{r,warning=FALSE,message=FALSE}

# Borramos las columnas en cuestion
data <- data %>%
  select(-colnames(data)[1], -colnames(data)[6])

# Eliminamos las filas con valor "N/A"
i <- 1
for (col in colnames(data)) {
  data <- data %>%
  filter(data[ ,i] != "N/A")
  i <- i + 1
}

```

\
**Para evitar problemas con las gráficas, cambie el nombre de las columnas con una o varias palabras clave con la que se entienda la información que contiene la columna. A modo de ejemplo, la columna correspondiente a la pregunta 9 "9.How often do you find yourself using Social media without a specific purpose?" se puede resumir en "SM_no_Purpose"**\
**Antes de cambiar el nombre de las columnas, se aconseja crear una variable con le nombre original de las preguntas.**\
NOTA: no hay, hasta donde yo sé, una función que haga esto en R. En otras palabras, tenéis que ir uno a uno.

```{r,warning=FALSE,message=FALSE}
# Renombramos las columnas
data <- data %>%
  rename(
    age = X1..What.is.your.age.,
    gender = X2..Gender,
    relationship = X3..Relationship.Status,
    occupation = X4..Occupation.Status,
    Yes_No = X6..Do.you.use.social.media.,
    platforms = X7..What.social.media.platforms.do.you.commonly.use.,
    avg_time = X8..What.is.the.average.time.you.spend.on.social.media.every.day.,
    SM_use_no_purpose = X9..How.often.do.you.find.yourself.using.Social.media.without.a.specific.purpose.,
    SM_times_distracted = X10..How.often.do.you.get.distracted.by.Social.media.when.you.are.busy.doing.something.,
    SM_restless = X11..Do.you.feel.restless.if.you.haven.t.used.Social.media.in.a.while.,
    SM_distracted_scale = X12..On.a.scale.of.1.to.5..how.easily.distracted.are.you.,
    SM_bothered_scale = X13..On.a.scale.of.1.to.5..how.much.are.you.bothered.by.worries.,
  SM_difficult_concentrate =X14..Do.you.find.it.difficult.to.concentrate.on.things.,
  SM_compare_with_others = X15..On.a.scale.of.1.5..how.often.do.you.compare.yourself.to.other.successful.people.through.the.use.of.social.media.,
  SM_comparisions_feelings = X16..Following.the.previous.question..how.do.you.feel.about.these.comparisons..generally.speaking.,
  SM_validation_seek = X17..How.often.do.you.look.to.seek.validation.from.features.of.social.media.,
  SM_depressed_often = X18..How.often.do.you.feel.depressed.or.down.,
  SM_daily_activities_interest = X19..On.a.scale.of.1.to.5..how.frequently.does.your.interest.in.daily.activities.fluctuate.,
  SM_sleeping_issues =X20..On.a.scale.of.1.to.5..how.often.do.you.face.issues.regarding.sleep.
  )

```

# Problema 2 (2 puntos)

**Se desea generar una gráfica que permita evaluar si las respuestas tienen relación. En concreto, se quiere evaluar las respuestas numéricas (las que pueden tomar un valor entre 1 y 5).**\
Pista: se puede utilizar la función `cor` para calcular la correlación y la función `corrplot` de la librería 'corrplot' para graficar. Mirar la ayuda de la función os puede dar alguna pista de como hacer la gráfica.

```{r,warning=FALSE,message=FALSE}
# Se escogen las columnas numericas y se evaluan las relaciones entre ellas
res <- cor(data[8:19])

# Se genera el gráfico con los resultados de la linea anterior
corrplot(res)
```

\
**Para las respuestas a las preguntas que toman valores entre 1 y 5, se quiere visualizar en una gráfica cual fue la proporción de cada tipo de respuesta.**

```{r,warning=FALSE,message=FALSE}
# Se reorganizan las columnas por filas para las columnas que toman valores entre 1 y 5 que anteriormente han sido cuidadosamente renombrados para que los nombres de estas columnas empiecen con "SM"
data2 <- data %>%
  pivot_longer(
    cols = starts_with("SM"),
    names_to = "SM_question",         
    values_to = "total"        
  )

# Se ordenan las filas segun los valores entre 1 y 5 (columna 'total') 
data2 <- data2 %>%
  arrange(total)

# Se realiza un gráfico por barras en el que podemos ver por cada columna una barra, y cada barra esta conformado por 5 colores segun el valor de la respuesta
ggplot(data2, aes(x=data2$SM_question, y=data2$total, fill=data2$total)) +
  geom_bar(stat='identity', position='fill') 
```

# Problema 3 (3 puntos)

**En este primer test de hipótesis se desea evaluar si el hecho de ser mujer aumenta las probabilidades de tener depresión. Considere que las personas que tienen depresión son las que han contestado a la pregunta "18. How often do you feel depressed or down?" con un valor igual o superior a 3. Para considerar el si el test es "greater" o "less", tenga en cuenta el orden de los facotres.**\
Nota: para este análisis solo considere las personas que han contestado "Female" o "Male".

```{r,warning=FALSE,message=FALSE}
# Este ejercicio no me ha dado tiempo de acabar

dataFemale <- data %>%
  filter(gender == "Female")

#Realizamos el teste de shapiro para ver si los datos siguen una distribucion normal
shapiro.test(dataFemale$SM_depressed_often)


#Como no siguen una distribucion normal, realizaremos el test de wilcox

wilcox.test(dataFemale$SM_depressed_often, 2, alternative = "greater", exact = FALSE)

#Con un pvalue de  4.673e-13, observamos siginficancia estadistica de que ser mujer aumente la probabilidad de tener depresion

```

\
\
**Se desea construir un modelo de regresión logística para predecir si una persona tiene depresión o no. Para ello considere para hacer la predicción las siguientes variables explicativas: Edad, sexo y el número de apps que utiliza el usuario. Por último, solo considere las personas que han contestado "Female" o "Male" en la preguta sobre el género. Considere que tienen depresión los que han contestado a la pregunta "18. How often do you feel depressed or down?" con un valor igual o superior a 3.**\
Nota: Para construir la variable con el número de apps tiene que utilizar la variable que corresponde a la pregunta 7."7.What social media platforms do you commonly use?"

```{r,warning=FALSE,message=FALSE}


data4 <- data %>%
  filter(gender %in% c("Male", "Female"))

data4 <- data4 %>%
  mutate(
    depressed_yesno = SM_depressed_often >= 3
  )

index <- 1
platform_cont <- c()
for (platforms in data4$platforms) {
  platform_cont[index] <- length(unlist(strsplit(platforms, ',')))
  index <- index +1
}

data4 <- data4 %>%
  mutate(
    nplatforms = platform_cont
  )

data4 <- data4 %>%
  select(age, gender, nplatforms, depressed_yesno)

# Al querer predecir si tiene depresion o no (binario), utilizaremos la familia binomial

y<- data4$depressed_yesno
x1 <- data4$age
x2 <- data4$gender
x3 <- data4$nplatforms
glm_fit <- glm(y ~ x1 + x2 + x3, data = data4, family = binomial(link = "logit"))

glm_fit

```

**Basándose en los resultados del modelo, ¿tener más apps aumenta o disminuye las probabilidades de tener depresión?**

Basandome en que el coeficiente de x3 (numero de plataformas) es 0.13185, tener mas apps aumenta las probabilidades de tener depresión

# Problema 4 (2 puntos)

**Con las preguntas cuyas respuestas pueden tomar valores entre 1 y 5, se desea realizar un análisis de componentes principales. Para este análisis no incluir la pregunta "18. How often do you feel depressed or down?". Dibujar las 2 componentes principales y colorear los puntos en función de si una persona tienen depresión o no. El criterio para determinar si una persona tiene depresión o no es el mismo que en los ejercicios anteriores.**

```{r,warning=FALSE,message=FALSE}

data5 <- data %>%
  mutate(
    depressed_yesno = SM_depressed_often >= 3
  )

data5 <- data5 %>%
  relocate(SM_depressed_often, .after = depressed_yesno)

pca_resultado <- prcomp(data5[,8:18], center = TRUE, retx = TRUE)

data_pca <- data.frame(PC1 = pca_resultado$x[, 1], 
                       PC2 = pca_resultado$x[, 2],
                       clase = data5$depressed_yesno) # clase es la columna que dice el tipo o la 'etiqueta'

ggplot(data_pca, aes(PC1, PC2, color = clase)) + 
  geom_point(size = 3, alpha = 0.7) +
  theme_minimal() +
  ggtitle("PCA - Componentes principales 1 y 2")
```

# Problema 5 (2 puntos)

**Para este ejercicio nos vamos a centrar en hombres ("Male") solteros ("Single"). Queremos evaluar en este subset si la edad es diferente para las personas que afirman tener depresión y la personas que afirman no tener depresión. Considere que la edad se comporta según una distribución normal.**

```{r,warning=FALSE,message=FALSE}
data6 <- data %>%
  filter(data$gender == 'Male', relationship == 'Single')

data6 <- data6 %>%
  mutate(
    depressed_yesno = data6$SM_depressed_often >= 3
  )

data6_depressed <- data6 %>%
  filter(depressed_yesno == TRUE)

data6_not_depressed <- data6 %>%
  filter(depressed_yesno == FALSE)

t.test(data6_depressed$age, data6_not_depressed$age, alternative = "two.sided")

```

**Según los resultados que ha obtenido, ¿se puede afirmar si diferencia?**

Segun el resultado que he obtenido, siendo p-value = 0.93, no se puede afirmar que la edad sea distinta en el subgrupo de hombres solteros\
\
\
**Si quisiéramos observar una diferencia de medias igual 2 y con un potencia estadística (power) del 80%, ¿Cuál es el número de muestras que haría falta? Considere la varianza poblacional igual a 11.7** $\sigma^2 = 11.7$

```{r,warning=FALSE,message=FALSE}
# Effect size (d de Cohen): diferencia estandarizada
d <- abs(2) / sqrt(11.7)
result <- pwr.t.test(d = d, sig.level = 0.05, power = 0.8, 
                     type = "two.sample", alternative = "two.sided")
N_pwr <- 2 * result$n  # result$n es por grupo, multiplicar por 2 para total
N_pwr

# Harian falta 94 personas para lograr un poder estadistico del 80%
```

**Según los resultados observados y dado el muestreo que tenemos, ¿podríamos alcanzar una potencia estadística del 80%?**:

```{r,warning=FALSE,message=FALSE}
nmuestras <- dim(data6)[1]
nmuestras


if(nmuestras > N_pwr) {
  cat("Podríamos alcanzar una potencia estadística del 80%")
} else {
  cat("No podríamos alcanzar una potencia estadística del 80%")
}
```
