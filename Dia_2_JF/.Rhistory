library(ggplot2)
# scatter plot: ######
Fig1 <- ggplot(data = mpg) + geom_point(aes(x = displ, y = hwy))
Fig1
Fig1+theme_bw()
# Example scatter plot with regression line
Fig2 <- Fig1 +  geom_smooth(aes(x = displ, y = hwy),
method = 'lm', formula = y ~ x)
c_h <- round(cor(mpg$displ, mpg$hwy, method = 'pearson'),2)
Fig2 <- Fig2 + geom_label(aes(x = 3, y = 45),
label = paste0('Corr:',as.character(c_h)),
show.legend = F, fill = 'white', color = 'blue')
Fig2
# Example scatter plot with color
Fig3 <- ggplot(data = mpg) + geom_point(aes(x = displ,
y = hwy, color= class))
Fig3
# Example scatter plot by facets
Fig4 <- Fig3 + facet_wrap(~ class, nrow = 3)
Fig4
Fig5 <- Fig4 + theme(legend.position = 'none')
Fig5
# Example scatter plot by facets – change the name of the axes and title
Fig6 <- Fig5+
xlab('Engine displacement') + ylab('Highway miles per gallon') +
ggtitle ('Comsuption vs Displacement')
Fig6
# Example scatter plot by facets – change the margin of the text
Fig7 <- Fig6 + theme(plot.title = element_text(hjust = 0.5,
margin=margin(0,0,10,0),
size = 11),
axis.text.x = element_text(margin=margin(0,0,10,0)),
axis.text.y = element_text(margin=margin(0,0,0,10)))
Fig7
# Example scatter plot by facets – change style of the grid
Fig8 <- Fig7 + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank())
Fig8
# Example scatter plot by facets – change the colors manually and save picture
Fig9 <- Fig8 + scale_color_manual(values = c('red', 'blue', 'orange',
'black', 'yellow',
'pink', 'green'))
Fig9
## Box-plot of engine-displacement by class of cars
Fig10 <- ggplot(data = mpg, aes(class,displ)) +
geom_boxplot(color="red", fill="orange",
alpha=0.2, width = 0.8) +
stat_boxplot(geom = 'errorbar', color="red", width = 0.4)+
theme_classic() +
theme(plot.title = element_text(hjust = 0.5,
margin=margin(0,0,10,0),
face = 'bold'),
axis.ticks.x = element_blank()) +
xlab('Class') + ylab('Engine displacement') +
ggtitle('Boxplot- Engine displacement')
x=rnorm(20,mean=2,sd=1)
t.test(x) #one-sample t.test
x=rnorm(20,mean=2,sd=1)
t.test(x) #one-sample t.test
y=rnorm(24,mean=4,sd=2)
t.test(x,y,alternative="two.sided") #dos colas
t.test(x,y,alternative="greater") # x > y
t.test(x,y,alternative="less") # x < y
shapiro.test(x,y)
shapiro.test(x)
help(shapiro.test)
set.seed(123)
shapiro.test(x)
x=rnorm(20,mean=2,sd=1)
shapiro.test(x)
# ------------------------------------
# 1) 1 muestra: t.test vs. Wilcoxon
# ------------------------------------
x <- rnorm(20, mean = 2, sd = 1)  # ejemplo
mu0 <- 2
cat("\n--- 1 MUESTRA ---\n")
sh <- shapiro.test(x)
print(sh)
if (sh$p.value > 0.05) {
cat("Usar t.test (1 muestra)\n")
print(t.test(x, mu = mu0))
} else {
cat("Usar Wilcoxon (1 muestra)\n")
print(wilcox.test(x, mu = mu0, conf.int = TRUE, exact = FALSE))
}
# ----------------------------------------------
# 2) 2 muestras independientes: Welch vs. MW
# ----------------------------------------------
x2 <- rnorm(20, mean = 2, sd = 1)
y2 <- rnorm(24, mean = 4, sd = 2)
cat("\n--- 2 MUESTRAS INDEPENDIENTES ---\n")
shx <- shapiro.test(x2); shy <- shapiro.test(y2)
print(list(p_shapiro_x = shx$p.value, p_shapiro_y = shy$p.value))
if (shx$p.value > 0.05 && shy$p.value > 0.05) {
cat("Usar Welch Two Sample t-test\n")
print(t.test(x2, y2))  # por defecto Welch
} else {
cat("Usar Mann-Whitney (Wilcoxon rank-sum)\n")
print(wilcox.test(x2, y2, conf.int = TRUE, exact = FALSE))
}
# -----------------------------
# 3) Pareado: t pareado vs. W
# -----------------------------
pre  <- rnorm(20, 10, 3)
post <- pre + rnorm(20, 1, 2)  # mejora media ~1
difs <- post - pre
cat("\n--- PAREADO ---\n")
shd <- shapiro.test(difs)
print(shd)
if (shd$p.value > 0.05) {
cat("Usar t.test pareado\n")
print(t.test(pre, post, paired = TRUE))
} else {
cat("Usar Wilcoxon pareado\n")
print(wilcox.test(pre, post, paired = TRUE, conf.int = TRUE, exact = FALSE))
}
# -------------------------------------
# 4) >2 grupos: ANOVA vs. Kruskal
# -------------------------------------
g1 <- rnorm(25, 0, 1)
g2 <- rnorm(25, 0.5, 1.2)
g3 <- rnorm(25, 1, 1.5)
y  <- c(g1, g2, g3)
g  <- factor(rep(c("g1","g2","g3"), each = 25))
cat("\n--- >2 GRUPOS ---\n")
p_norm <- tapply(y, g, function(v) shapiro.test(v)$p.value)
print(p_norm)
if (all(p_norm > 0.05)) {
cat("Usar ANOVA\n")
fit <- aov(y ~ g)
print(anova(fit))
cat("\nPost-hoc Tukey:\n")
print(TukeyHSD(fit))
} else {
cat("Usar Kruskal-Wallis\n")
print(kruskal.test(y ~ g))
cat("\nPost-hoc por pares (ajuste BH):\n")
print(pairwise.wilcox.test(y, g, p.adjust.method = "BH"))
}
cat("\nListo. Fin del flujo básico.\n")
x=rnorm(20,mean=2,sd=1)
y=rnorm(20,mean=4,sd=2)
t.test(x,y,paired=TRUE)
#anova
x=rnorm(20,mean=2,sd=1)
y=rnorm(20,mean=4,sd=2)
z=rnorm(20,mean=0,sd=1)
zz=c(x,y,z)
g<-as.factor(c(rep('g1', 20), rep('g2', 20),rep('g3', 20)))
model=aov(zz~g)
anova(model)
#t.testy anovason equivalente
t.test(x,y,var.equal=TRUE)
anova(aov(c(x,y) ~as.factor(c(rep('g1', 20), rep('g2', 20)))))
#t.testvs wilcoxon
x=rnorm(20,mean=2,sd=1)
y=rnorm(20,mean=4,sd=2)
x[1] = 20
boxplot(x,y)
t.test(x,y)
wilcox.test(x,y)
#anovavs k-w
x=rnorm(20,mean=2,sd=1)
y=rnorm(20,mean=4,sd=2)
z=rnorm(20,mean=6,sd=1)
x[1] = 35
y[1] = 0;y[2] = 40
z[1] = 1
boxplot(x,y,z)
zz=c(x,y,z)
g<-as.factor(c(rep('g1', 20), rep('g2', 20),rep('g3', 20)))
model=aov(zz~g)
anova(model)
kruskal.test(zz~g)
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(viridis)
library(ggrepel)
library(dplyr)
library(tm)
library(textstem)
library(pwr)
library(tidyr)
library(stringr)
data <- read.csv('CrimeUS.csv', header = T, sep = ',', stringsAsFactors = F)
View(data)
ggplot(data, aes(x = year, y = robbery, color = state)) +
geom_line()
data2 <- data %>%
select(year, violent, murder, robbery)
data2 <- data2 %>%
pivot_longer(
cols = c('robbery', 'violent', 'murder'),
names_to = 'crimen',
values_to = 'cant'
)
data3 <- data2 %>%
group_by(year, crimen) %>%
summarise(cant_2 = sum(cant)) %>%
ungroup()
ggplot(data3, aes(x = year, y = cant_2, color = crimen))+
geom_line()
data_pr <- data %>%
select(year, prisoners, state)%>%
filter(year >= 1980 & year <=1990)%>%
filter(state %in% c("Alabama", "Arizona", "Florida")) %>%
group_by(year) %>%
mutate(
cant_year = sum(prisoners)
) %>%
ungroup()
ggplot(data_pr, aes(x= year, y = cant_year, color = state)) +
geom_col()
data_pr <- data %>%
select(year, prisoners, state)%>%
filter(year >= 1980 & year <=1990)%>%
filter(state %in% c("Alabama", "Arizona", "Florida")) %>%
group_by(year) %>%
mutate(
cant_year = sum(prisoners)
) %>%
ungroup()
ggplot(data_pr, aes(x= year, y = cant_year, color = state)) +
geom_col() +
theme_bw()
mdl <- lm(prisoners ~ state, data = data_pr)
anova_1 <- anova(mdl)
anova_1
data6 <- data %>%
select(year, robbery, prisoners)%>%
group_by(year) %>%
summarise(
count_r = sum(robbery),
count_p = sum(prisoners)
)%>%
ungroup()
ggplot(data6, aes(x=count_r, y=count_p, color=year)) +
geom_point(size = 5)
data_n <- data %>%
select(year, violent, murder, robbery, prisoners, state) %>%
filter(state %in% c('Nevada'))
cor.test(x= data_n$violent, y= data_n$prisoners, alternative = 'two.sided')
cor.test(x= data_n$murder, y= data_n$prisoners, alternative = 'two.sided')
cor.test(x= data_n$robbery, y= data_n$prisoners, alternative = 'two.sided')
ggplot(data_n, aes(x=murder, y=prisoners)) +
geom_point() +
geom_smooth(method = 'lm')
data_n <- data %>%
select(year, violent, murder, robbery, prisoners, state) %>%
filter(state %in% c('Nevada'))
cor.test(x= data_n$violent, y= data_n$prisoners, alternative = 'two.sided')
cor.test(x= data_n$murder, y= data_n$prisoners, alternative = 'two.sided')
cor.test(x= data_n$robbery, y= data_n$prisoners, alternative = 'two.sided')
ggplot(data_n, aes(x=violent, y=prisoners)) +
geom_point() +
geom_smooth(method = 'lm')
data_a1 <- data %>%
select(year, murder) %>%
filter(year >= 1977 & year <= 1988)
data_a2 <- data %>%
select(year, murder) %>%
filter(year >= 1989 & year <= 1999)
t.test(data_a1, data_a2, paired = FALSE,
mu = 0,
)
ggplot(data_a1, aes(murder)) +
geom_histogram()
ggplot(data_a2, aes(murder)) +
geom_histogram()
data_a1 <- data %>%
select(year, murder) %>%
filter(year >= 1977 & year <= 1988)
data_a1 <- data %>%
select(year, murder) %>%
filter(year >= 1977 & year <= 1988)
data_a2 <- data %>%
select(year, murder) %>%
filter(year >= 1989 & year <= 1999)
sh1 <- shapiro.test(data_a1$murder)
sh2 <- shapiro.test(data_a2$murder)
t.test(data_a1$murder, data_a2$murder, paired = FALSE,
mu = 0,
)
ggplot(data_a1, aes(murder)) +
geom_histogram()
ggplot(data_a2, aes(murder)) +
geom_histogram()
print(sh1)
print(sh2)
wilcox.test(data_a1$murder, data_a2$murder, conf.int = TRUE, exact = FALSE)
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(viridis)
library(ggrepel)
library(dplyr)
library(tm)
library(textstem)
library(pwr)
library(tidyr)
library(stringr)
data <- read.csv('./data/CrimeUS.csv', header = T, sep = ',', stringsAsFactors = F)
data <- read.csv('CrimeUS.csv', header = T, sep = ',', stringsAsFactors = F)
df <- matrix(data = data$murder, nrow = length(unique(data$state)), byrow = T)
rownames(df) <- unique(data$state)
colnames(df) <- as.character(unique(data$year))
years <- c(1977, 1978, 1979, 1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988)
idx <- !is.element(colnames(df), years)
View(data)
View(df)
pval <- apply(df, 1, function(x) t.test(x[idx],x[!idx], paired = F)$p.value)
pval_corrected <- p.adjust(pval, method = 'BH')
fc <- apply(df,1, function(x) log2(mean(x[idx])/mean(x[!idx])))
df <- data.frame(pval = -log10(pval_corrected), fc = fc)
df$sig <- factor(rep(0,nrow(df)), levels = c(-1,0,1))
df$sig[pval_corrected < 0.05 & fc < -1] <- -1
df$sig[pval_corrected < 0.05 & fc > 1] <- 1
df$lab <- ''
df$lab[df$sig != 0] <- names(pval_corrected)[df$sig != 0]
vp1 <- ggplot(data = df) + geom_point(aes(x = fc, y = pval, colour = sig), size = 2.5) +
theme_classic() + scale_x_continuous(limits = c((-max(abs(fc)) - 0.5),(max(abs(fc)) + 0.5))) +
scale_color_manual(values = c("#2600D1FF","#000000","#D60C00FF"), drop = F) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_rect(colour = 'black', size = 1), legend.position = 'none',
plot.title = element_text(hjust = 0.5)) +
xlab(bquote(~Log[2]~Fold~Change)) + ylab(bquote(~-Log[10]~Adjusted~p-Value)) +
geom_hline(yintercept = -log10(0.05), linetype = 'dashed') +
geom_vline(xintercept = -1, linetype = 'dashed') + geom_vline(xintercept = 1, linetype = 'dashed') +
geom_text_repel(aes(x = fc, y = pval, label = ifelse(sig != 0, lab, ''))) +
ggtitle('States with more or less murder incidence with time')
vp1
## EJERCICIO 1
# 1) Cargar datos
df <- read.csv("season-1819_csv.csv", stringsAsFactors = FALSE)
# 2) Función auxiliar: arma tablas para un equipo dado
team_tables <- function(df, team_name) {
# Partidos del equipo como local y visitante
m_home <- subset(df, HomeTeam == team_name)
m_away <- subset(df, AwayTeam == team_name)
m_home$Venue <- "Home"
m_away$Venue <- "Away"
m <- rbind(m_home, m_away)
# (A) Tabla 2x3: Venue x FTR (H/D/A del dataset)
tab_2x3 <- with(m, table(Venue, FTR))
# Reordenar columnas por claridad
tab_2x3 <- tab_2x3[, c("H","D","A")]
# (B) Crear variable "Win" desde la perspectiva del equipo:
# - Si jugó de local, gana cuando FTR == "H"
# - Si jugó de visita, gana cuando FTR == "A"
m$Win <- ifelse(m$Venue == "Home" & m$FTR == "H", 1,
ifelse(m$Venue == "Away" & m$FTR == "A", 1, 0))
m$Win <- factor(m$Win, levels = c(1,0), labels = c("Win","NoWin"))
# (C) Tabla 2x2: Win vs Venue (para el test de asociación)
tab_2x2 <- with(m, table(Win, Venue))
tab_2x2 <- tab_2x2[c("Win","NoWin"), c("Home","Away")]  # ordenar filas/columnas
list(data = m, tab_FTR = tab_2x3, tab_WinVenue = tab_2x2)
}
# 3) Aplicar a Real Sociedad (en el csv aparece como "Sociedad") y Barcelona
soc <- team_tables(df, "Sociedad")
fcb <- team_tables(df, "Barcelona")
View(fcb)
View(fcb)
View(fcb)
View(soc)
# 4) Mostrar tablas 2x3 (Venue x FTR)
soc$tab_FTR
fcb$tab_FTR
soc_fisher
soc_chisq  <- chisq.test(soc$tab_WinVenue, correct = TRUE)
fcb_chisq  <- chisq.test(fcb$tab_WinVenue, correct = TRUE)
soc_fisher
# 6) Test de asociación Win ~ Venue
#    Usamos Fisher por seguridad (funciona bien con conteos pequeños).
#    También puedes ver chisq.test(tab_2x2, correct=TRUE) para el chi-cuadrado con corrección de Yates.
soc_fisher <- fisher.test(soc$tab_WinVenue)      # Real Sociedad
fcb_fisher <- fisher.test(fcb$tab_WinVenue)      # Barcelona
soc_chisq  <- chisq.test(soc$tab_WinVenue, correct = TRUE)
fcb_chisq  <- chisq.test(fcb$tab_WinVenue, correct = TRUE)
soc_fisher
soc_chisq
